## Leader not available 에러

유효한 리더가 없을 때 발생하는 에러이다. 어떤 이유로 발생하는지, 어떻게 해결하는지 알아보자.

## 카프카 클라이언트 메타데이터

카프카 클라이언트(프로듀서 or 컨슈머)는 통신하고자 하는 리더 파티션의 위치를 알기 위해 메타데이터 정보를 활용한다. 본격적으로 메시지를 주고 받기 전에, 클라이언트는 브로커에게 메타데이터 요청을 보내고 응답을 받는다.

## 왜 발생할까?

하지만 만약 메타데이터가 최신의 상태를 유지하고 있지 않다면, 클라이언트는 리더 파티션을 찾을 수 없고, Leader not available 에러가 발생하게 된다.

## 어떻게 예방할까?

카프카 프로듀서에 메타데이터 옵션이 있다.

- `metadata.max.age.ms`: 메타데이터를 강제로 리프레시 하는 간격. 기본값은 5분이다.
- `metadata.max.idle.ms`: 프로듀서가 유휴상태일 경우 메타데이터를 캐시에 유지하는 시간이다. 예를 들어, 프로듀서가 특정 토픽으로 메시지를 보낸 이후 설정한 시간이 지나고 나면 강제로 메타데이터를 리프레시한다. 기본값은 5분이다.

이 에러가 자주 발생한다면, 위 설정 값을 더 짧게 조정해보자.