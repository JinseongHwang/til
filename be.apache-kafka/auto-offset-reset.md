## auto.offset.reset 옵션이란?

`auto.offset.reset` 옵션은 초기 오프셋이 없거나 현재 오프셋이 서버에 더 이상 존재하지 않는 경우 컨슈머의 동작 방식을 결정하는 설정이다.

**`:earliest`**

- 마지막 커밋 기록이 없을 경우, 가장 오래된 레코드부터 처리하는 방식

**`:latest`**

- 마지막 커밋 기록이 없을 경우, 가장 최근 레코드부터 처리하는 방식
- 디폴트 값이다.

**`:none`**

- 마지막 커밋 기록이 없을 경우, 예외 발생!

## 데이터가 유실되는 이유

파티션 개수가 변경될 때
1. `~ --alter --partitions 10` -> 파티션의 개수를 10로 늘렸더니
2. 컨슈머는 `metadata.max.age.ms` 만큼 메타데이터 리프레시 기간동안 대기
3. 리프레시가 끝나면 컨슈머 리밸런싱

하지만 여기서 2번 과정, 메타데이터 리프레시 기간 동안 컨슈머는 새로운 파티션이 들어왔음을 인지한다. 인지하는 과정에서 새롭게 추가된 파티션에 레코드가 쌓일 수 있다.

만약 메타데이터 리프레시 시간 동안 새 파티션에 10개의 메시지가 쌓였다고 가정하자. 이때 `auto.offset.reset: latest` 옵션을 사용한다면, 새롭게 추가된 파티션에 할당된 컨슈머는 가장 최근 메시지부터 읽으며, 그 이전에 들어온 9개의 메시지는 유실된다.

## 어떻게 막을 수 있을까?

디폴트 값인 latest를 사용하면 유실될 수 있다. 따라서 earlist로 바꿔서 사용하자. 메시지를 유실하는 경우를 예방할 수 있다.